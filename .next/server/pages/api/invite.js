"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/invite";
exports.ids = ["pages/api/invite"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next-auth":
/*!****************************!*\
  !*** external "next-auth" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("next-auth");

/***/ }),

/***/ "next-auth/providers/credentials":
/*!**************************************************!*\
  !*** external "next-auth/providers/credentials" ***!
  \**************************************************/
/***/ ((module) => {

module.exports = require("next-auth/providers/credentials");

/***/ }),

/***/ "next-auth/providers/google":
/*!*********************************************!*\
  !*** external "next-auth/providers/google" ***!
  \*********************************************/
/***/ ((module) => {

module.exports = require("next-auth/providers/google");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Finvite&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Finvite.ts&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Finvite&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Finvite.ts&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_invite_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/invite.ts */ \"(api)/./pages/api/invite.ts\");\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_invite_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_invite_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/invite\",\n        pathname: \"/api/invite\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_invite_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmludml0ZSZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTJGYXBpJTJGaW52aXRlLnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ2tEO0FBQ2xEO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQyxpREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsaURBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVEIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3ByaW50LWNhcGFjaXR5LWFwcC8/ZmEyYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXMvYXBpL2ludml0ZS50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2ludml0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2ludml0ZVwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Finvite&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Finvite.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/auth.ts":
/*!*********************!*\
  !*** ./lib/auth.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions),\n/* harmony export */   nextAuthConfig: () => (/* binding */ nextAuthConfig),\n/* harmony export */   validateAuthEnv: () => (/* binding */ validateAuthEnv)\n/* harmony export */ });\n/* harmony import */ var next_auth_providers_google__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/providers/google */ \"next-auth/providers/google\");\n/* harmony import */ var next_auth_providers_google__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth_providers_google__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/credentials */ \"next-auth/providers/credentials\");\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./prisma */ \"(api)/./lib/prisma.ts\");\n\n\n\nconst authOptions = {\n    providers: [\n        // Enable Google provider if keys provided\n        ...process.env.GOOGLE_CLIENT_ID && process.env.GOOGLE_CLIENT_SECRET ? [\n            next_auth_providers_google__WEBPACK_IMPORTED_MODULE_0___default()({\n                clientId: process.env.GOOGLE_CLIENT_ID,\n                clientSecret: process.env.GOOGLE_CLIENT_SECRET\n            })\n        ] : [],\n        // Credentials provider for local dev/testing only\n        ... true ? [\n            next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1___default()({\n                name: \"Dev Sign-in\",\n                credentials: {\n                    email: {\n                        label: \"Email\",\n                        type: \"text\"\n                    },\n                    name: {\n                        label: \"Name\",\n                        type: \"text\"\n                    }\n                },\n                async authorize (credentials) {\n                    if (!credentials?.email) return null;\n                    return {\n                        id: credentials.email,\n                        email: credentials.email,\n                        name: credentials.name || credentials.email\n                    };\n                }\n            })\n        ] : 0\n    ],\n    callbacks: {\n        async signIn ({ user }) {\n            if (!user?.email) return false;\n            const email = user.email.toLowerCase();\n            // If user already exists, allow sign in and update metadata\n            const existing = await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.findUnique({\n                where: {\n                    email\n                }\n            });\n            if (existing) {\n                try {\n                    await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.update({\n                        where: {\n                            email\n                        },\n                        data: {\n                            name: user.name ?? existing.name,\n                            image: user.image ?? existing.image\n                        }\n                    });\n                } catch (e) {\n                    console.warn(\"Failed to update existing user metadata\", e);\n                }\n                return true;\n            }\n            // New user: bootstrap the first signer as ADMIN (application admin)\n            const adminCount = await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.count({\n                where: {\n                    role: \"ADMIN\"\n                }\n            });\n            if (adminCount === 0) {\n                await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.create({\n                    data: {\n                        email,\n                        name: user.name,\n                        image: user.image,\n                        role: \"ADMIN\"\n                    }\n                });\n                return true;\n            }\n            // Otherwise, allow registration only if there's a pending invitation for this email\n            const invite = await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.invitation.findFirst({\n                where: {\n                    email,\n                    status: \"PENDING\"\n                }\n            });\n            if (invite) {\n                const created = await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.create({\n                    data: {\n                        email,\n                        name: user.name,\n                        image: user.image,\n                        role: \"MEMBER\"\n                    }\n                });\n                try {\n                    if (invite.squadId) {\n                        await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.squadMember.create({\n                            data: {\n                                userId: created.id,\n                                squadId: invite.squadId\n                            }\n                        });\n                    }\n                    await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.invitation.update({\n                        where: {\n                            id: invite.id\n                        },\n                        data: {\n                            status: \"ACCEPTED\"\n                        }\n                    });\n                } catch (e) {\n                    console.warn(\"Failed to attach invited user to squad or update invitation\", e);\n                }\n                return true;\n            }\n            // No invite and not the bootstrap scenario — block sign in and redirect to a friendly page\n            return \"/auth/no-access\";\n        },\n        async jwt ({ token, user }) {\n            // When a user signs in, attach their DB role to the token\n            if (user?.email) {\n                const dbUser = await _prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.user.findUnique({\n                    where: {\n                        email: user.email.toLowerCase()\n                    }\n                });\n                token.role = dbUser?.role ?? \"MEMBER\";\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            session.user.role = token.role ?? \"MEMBER\";\n            return session;\n        }\n    },\n    session: {\n        strategy: \"jwt\"\n    }\n};\n// Expose secret and debug flag for NextAuth when imported elsewhere\nconst nextAuthConfig = {\n    secret: process.env.NEXTAUTH_SECRET,\n    debug: \"development\" !== \"production\"\n};\nfunction validateAuthEnv() {\n    const missing = [];\n    if (!process.env.NEXTAUTH_SECRET) missing.push(\"NEXTAUTH_SECRET\");\n    if (!process.env.NEXTAUTH_URL && !process.env.VERCEL_URL) missing.push(\"NEXTAUTH_URL\");\n    // Google provider requires both keys when enabled\n    if (process.env.GOOGLE_CLIENT_ID && !process.env.GOOGLE_CLIENT_SECRET) missing.push(\"GOOGLE_CLIENT_SECRET\");\n    if (process.env.GOOGLE_CLIENT_SECRET && !process.env.GOOGLE_CLIENT_ID) missing.push(\"GOOGLE_CLIENT_ID\");\n    if (missing.length) {\n        const msg = `Missing required env vars for NextAuth: ${missing.join(\", \")}`;\n        if (false) {} else {\n            console.warn(msg);\n        }\n    }\n    return missing;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUksQ0FBQ2hELFFBQVFDLEdBQUcsQ0FBQzRDLGVBQWUsRUFBRUcsUUFBUUMsSUFBSSxDQUFDO0lBQy9DLElBQUksQ0FBQ2pELFFBQVFDLEdBQUcsQ0FBQ2lELFlBQVksSUFBSSxDQUFDbEQsUUFBUUMsR0FBRyxDQUFDa0QsVUFBVSxFQUN0REgsUUFBUUMsSUFBSSxDQUFDO0lBQ2Ysa0RBQWtEO0lBQ2xELElBQUlqRCxRQUFRQyxHQUFHLENBQUNDLGdCQUFnQixJQUFJLENBQUNGLFFBQVFDLEdBQUcsQ0FBQ0Usb0JBQW9CLEVBQ25FNkMsUUFBUUMsSUFBSSxDQUFDO0lBQ2YsSUFBSWpELFFBQVFDLEdBQUcsQ0FBQ0Usb0JBQW9CLElBQUksQ0FBQ0gsUUFBUUMsR0FBRyxDQUFDQyxnQkFBZ0IsRUFDbkU4QyxRQUFRQyxJQUFJLENBQUM7SUFFZixJQUFJRCxRQUFRSSxNQUFNLEVBQUU7UUFDbEIsTUFBTUMsTUFBTSxDQUFDLHdDQUF3QyxFQUFFTCxRQUFRTSxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQzNFLElBQUl0RCxLQUF5QixFQUFjLEVBRTFDLE1BQU07WUFDTHdCLFFBQVFDLElBQUksQ0FBQzRCO1FBQ2Y7SUFDRjtJQUNBLE9BQU9MO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zcHJpbnQtY2FwYWNpdHktYXBwLy4vbGliL2F1dGgudHM/YmY3ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgR29vZ2xlUHJvdmlkZXIgZnJvbSAnbmV4dC1hdXRoL3Byb3ZpZGVycy9nb29nbGUnXG5pbXBvcnQgQ3JlZGVudGlhbHNQcm92aWRlciBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2NyZWRlbnRpYWxzJ1xuaW1wb3J0IHsgTmV4dEF1dGhPcHRpb25zIH0gZnJvbSAnbmV4dC1hdXRoJ1xuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnLi9wcmlzbWEnXG5pbXBvcnQgdHlwZSB7IFVzZXJSb2xlIH0gZnJvbSAnQHByaXNtYS9jbGllbnQnXG5cbmV4cG9ydCBjb25zdCBhdXRoT3B0aW9uczogTmV4dEF1dGhPcHRpb25zID0ge1xuICBwcm92aWRlcnM6IFtcbiAgICAvLyBFbmFibGUgR29vZ2xlIHByb3ZpZGVyIGlmIGtleXMgcHJvdmlkZWRcbiAgICAuLi4ocHJvY2Vzcy5lbnYuR09PR0xFX0NMSUVOVF9JRCAmJiBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX1NFQ1JFVFxuICAgICAgPyBbXG4gICAgICAgICAgR29vZ2xlUHJvdmlkZXIoe1xuICAgICAgICAgICAgY2xpZW50SWQ6IHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfSUQsXG4gICAgICAgICAgICBjbGllbnRTZWNyZXQ6IHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfU0VDUkVULFxuICAgICAgICAgIH0pLFxuICAgICAgICBdXG4gICAgICA6IFtdKSxcbiAgICAvLyBDcmVkZW50aWFscyBwcm92aWRlciBmb3IgbG9jYWwgZGV2L3Rlc3Rpbmcgb25seVxuICAgIC4uLihwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nXG4gICAgICA/IFtcbiAgICAgICAgICBDcmVkZW50aWFsc1Byb3ZpZGVyKHtcbiAgICAgICAgICAgIG5hbWU6ICdEZXYgU2lnbi1pbicsXG4gICAgICAgICAgICBjcmVkZW50aWFsczoge1xuICAgICAgICAgICAgICBlbWFpbDogeyBsYWJlbDogJ0VtYWlsJywgdHlwZTogJ3RleHQnIH0sXG4gICAgICAgICAgICAgIG5hbWU6IHsgbGFiZWw6ICdOYW1lJywgdHlwZTogJ3RleHQnIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBhc3luYyBhdXRob3JpemUoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgICAgaWYgKCFjcmVkZW50aWFscz8uZW1haWwpIHJldHVybiBudWxsXG4gICAgICAgICAgICAgIHJldHVybiB7IGlkOiBjcmVkZW50aWFscy5lbWFpbCwgZW1haWw6IGNyZWRlbnRpYWxzLmVtYWlsLCBuYW1lOiBjcmVkZW50aWFscy5uYW1lIHx8IGNyZWRlbnRpYWxzLmVtYWlsIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICBdXG4gICAgICA6IFtdKSxcbiAgXSxcbiAgY2FsbGJhY2tzOiB7XG4gICAgYXN5bmMgc2lnbkluKHsgdXNlciB9KSB7XG4gICAgICBpZiAoIXVzZXI/LmVtYWlsKSByZXR1cm4gZmFsc2VcbiAgICAgIGNvbnN0IGVtYWlsID0gdXNlci5lbWFpbC50b0xvd2VyQ2FzZSgpXG5cbiAgICAgIC8vIElmIHVzZXIgYWxyZWFkeSBleGlzdHMsIGFsbG93IHNpZ24gaW4gYW5kIHVwZGF0ZSBtZXRhZGF0YVxuICAgICAgY29uc3QgZXhpc3RpbmcgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHsgd2hlcmU6IHsgZW1haWwgfSB9KVxuICAgICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgcHJpc21hLnVzZXIudXBkYXRlKHsgd2hlcmU6IHsgZW1haWwgfSwgZGF0YTogeyBuYW1lOiB1c2VyLm5hbWUgPz8gZXhpc3RpbmcubmFtZSwgaW1hZ2U6IHVzZXIuaW1hZ2UgPz8gZXhpc3RpbmcuaW1hZ2UgfSB9KVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gdXBkYXRlIGV4aXN0aW5nIHVzZXIgbWV0YWRhdGEnLCBlKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG5cbiAgICAgIC8vIE5ldyB1c2VyOiBib290c3RyYXAgdGhlIGZpcnN0IHNpZ25lciBhcyBBRE1JTiAoYXBwbGljYXRpb24gYWRtaW4pXG4gICAgICBjb25zdCBhZG1pbkNvdW50ID0gYXdhaXQgcHJpc21hLnVzZXIuY291bnQoeyB3aGVyZTogeyByb2xlOiAnQURNSU4nIGFzIHVua25vd24gYXMgVXNlclJvbGUgfSB9KVxuICAgICAgaWYgKGFkbWluQ291bnQgPT09IDApIHtcbiAgICAgICAgYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHsgZGF0YTogeyBlbWFpbCwgbmFtZTogdXNlci5uYW1lLCBpbWFnZTogdXNlci5pbWFnZSwgcm9sZTogJ0FETUlOJyBhcyB1bmtub3duIGFzIFVzZXJSb2xlIH0gfSlcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cblxuICAgICAgLy8gT3RoZXJ3aXNlLCBhbGxvdyByZWdpc3RyYXRpb24gb25seSBpZiB0aGVyZSdzIGEgcGVuZGluZyBpbnZpdGF0aW9uIGZvciB0aGlzIGVtYWlsXG4gICAgICBjb25zdCBpbnZpdGUgPSBhd2FpdCBwcmlzbWEuaW52aXRhdGlvbi5maW5kRmlyc3QoeyB3aGVyZTogeyBlbWFpbCwgc3RhdHVzOiAnUEVORElORycgfSB9KVxuICAgICAgaWYgKGludml0ZSkge1xuICBjb25zdCBjcmVhdGVkID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHsgZGF0YTogeyBlbWFpbCwgbmFtZTogdXNlci5uYW1lLCBpbWFnZTogdXNlci5pbWFnZSwgcm9sZTogJ01FTUJFUicgYXMgdW5rbm93biBhcyBVc2VyUm9sZSB9IH0pXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaWYgKGludml0ZS5zcXVhZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBwcmlzbWEuc3F1YWRNZW1iZXIuY3JlYXRlKHsgZGF0YTogeyB1c2VySWQ6IGNyZWF0ZWQuaWQsIHNxdWFkSWQ6IGludml0ZS5zcXVhZElkIH0gfSlcbiAgICAgICAgICB9XG4gICAgICAgICAgYXdhaXQgcHJpc21hLmludml0YXRpb24udXBkYXRlKHsgd2hlcmU6IHsgaWQ6IGludml0ZS5pZCB9LCBkYXRhOiB7IHN0YXR1czogJ0FDQ0VQVEVEJyB9IH0pXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBhdHRhY2ggaW52aXRlZCB1c2VyIHRvIHNxdWFkIG9yIHVwZGF0ZSBpbnZpdGF0aW9uJywgZSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuXG4gICAgICAvLyBObyBpbnZpdGUgYW5kIG5vdCB0aGUgYm9vdHN0cmFwIHNjZW5hcmlvIOKAlCBibG9jayBzaWduIGluIGFuZCByZWRpcmVjdCB0byBhIGZyaWVuZGx5IHBhZ2VcbiAgICAgIHJldHVybiAnL2F1dGgvbm8tYWNjZXNzJ1xuICAgIH0sXG4gICAgYXN5bmMgand0KHsgdG9rZW4sIHVzZXIgfSkge1xuICAgICAgLy8gV2hlbiBhIHVzZXIgc2lnbnMgaW4sIGF0dGFjaCB0aGVpciBEQiByb2xlIHRvIHRoZSB0b2tlblxuICAgICAgaWYgKHVzZXI/LmVtYWlsKSB7XG4gICAgICAgIGNvbnN0IGRiVXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBlbWFpbDogdXNlci5lbWFpbC50b0xvd2VyQ2FzZSgpIH0gfSlcbiAgICAgICAgOyh0b2tlbiBhcyBhbnkpLnJvbGUgPSBkYlVzZXI/LnJvbGUgPz8gJ01FTUJFUidcbiAgICAgIH1cbiAgICAgIHJldHVybiB0b2tlblxuICAgIH0sXG4gICAgYXN5bmMgc2Vzc2lvbih7IHNlc3Npb24sIHRva2VuIH0pIHtcbiAgICAgIDsoc2Vzc2lvbi51c2VyIGFzIGFueSkucm9sZSA9ICh0b2tlbiBhcyBhbnkpLnJvbGUgPz8gJ01FTUJFUidcbiAgICAgIHJldHVybiBzZXNzaW9uXG4gICAgfVxuICB9LFxuICBzZXNzaW9uOiB7XG4gICAgc3RyYXRlZ3k6ICdqd3QnXG4gIH1cbn1cblxuLy8gRXhwb3NlIHNlY3JldCBhbmQgZGVidWcgZmxhZyBmb3IgTmV4dEF1dGggd2hlbiBpbXBvcnRlZCBlbHNld2hlcmVcbmV4cG9ydCBjb25zdCBuZXh0QXV0aENvbmZpZyA9IHtcbiAgc2VjcmV0OiBwcm9jZXNzLmVudi5ORVhUQVVUSF9TRUNSRVQsXG4gIGRlYnVnOiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nLFxufVxuXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVBdXRoRW52KCkge1xuICBjb25zdCBtaXNzaW5nOiBzdHJpbmdbXSA9IFtdXG4gIGlmICghcHJvY2Vzcy5lbnYuTkVYVEFVVEhfU0VDUkVUKSBtaXNzaW5nLnB1c2goJ05FWFRBVVRIX1NFQ1JFVCcpXG4gIGlmICghcHJvY2Vzcy5lbnYuTkVYVEFVVEhfVVJMICYmICFwcm9jZXNzLmVudi5WRVJDRUxfVVJMKVxuICAgIG1pc3NpbmcucHVzaCgnTkVYVEFVVEhfVVJMJylcbiAgLy8gR29vZ2xlIHByb3ZpZGVyIHJlcXVpcmVzIGJvdGgga2V5cyB3aGVuIGVuYWJsZWRcbiAgaWYgKHByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfSUQgJiYgIXByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfU0VDUkVUKVxuICAgIG1pc3NpbmcucHVzaCgnR09PR0xFX0NMSUVOVF9TRUNSRVQnKVxuICBpZiAocHJvY2Vzcy5lbnYuR09PR0xFX0NMSUVOVF9TRUNSRVQgJiYgIXByb2Nlc3MuZW52LkdPT0dMRV9DTElFTlRfSUQpXG4gICAgbWlzc2luZy5wdXNoKCdHT09HTEVfQ0xJRU5UX0lEJylcblxuICBpZiAobWlzc2luZy5sZW5ndGgpIHtcbiAgICBjb25zdCBtc2cgPSBgTWlzc2luZyByZXF1aXJlZCBlbnYgdmFycyBmb3IgTmV4dEF1dGg6ICR7bWlzc2luZy5qb2luKCcsICcpfWBcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgY29uc29sZS5lcnJvcihtc2cpXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2Fybihtc2cpXG4gICAgfVxuICB9XG4gIHJldHVybiBtaXNzaW5nXG59XG4iXSwibmFtZXMiOlsiR29vZ2xlUHJvdmlkZXIiLCJDcmVkZW50aWFsc1Byb3ZpZGVyIiwicHJpc21hIiwiYXV0aE9wdGlvbnMiLCJwcm92aWRlcnMiLCJwcm9jZXNzIiwiZW52IiwiR09PR0xFX0NMSUVOVF9JRCIsIkdPT0dMRV9DTElFTlRfU0VDUkVUIiwiY2xpZW50SWQiLCJjbGllbnRTZWNyZXQiLCJuYW1lIiwiY3JlZGVudGlhbHMiLCJlbWFpbCIsImxhYmVsIiwidHlwZSIsImF1dGhvcml6ZSIsImlkIiwiY2FsbGJhY2tzIiwic2lnbkluIiwidXNlciIsInRvTG93ZXJDYXNlIiwiZXhpc3RpbmciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJ1cGRhdGUiLCJkYXRhIiwiaW1hZ2UiLCJlIiwiY29uc29sZSIsIndhcm4iLCJhZG1pbkNvdW50IiwiY291bnQiLCJyb2xlIiwiY3JlYXRlIiwiaW52aXRlIiwiaW52aXRhdGlvbiIsImZpbmRGaXJzdCIsInN0YXR1cyIsImNyZWF0ZWQiLCJzcXVhZElkIiwic3F1YWRNZW1iZXIiLCJ1c2VySWQiLCJqd3QiLCJ0b2tlbiIsImRiVXNlciIsInNlc3Npb24iLCJzdHJhdGVneSIsIm5leHRBdXRoQ29uZmlnIiwic2VjcmV0IiwiTkVYVEFVVEhfU0VDUkVUIiwiZGVidWciLCJ2YWxpZGF0ZUF1dGhFbnYiLCJtaXNzaW5nIiwicHVzaCIsIk5FWFRBVVRIX1VSTCIsIlZFUkNFTF9VUkwiLCJsZW5ndGgiLCJtc2ciLCJqb2luIiwiZXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/auth.ts\n");

/***/ }),

/***/ "(api)/./lib/inviteService.ts":
/*!******************************!*\
  !*** ./lib/inviteService.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createInvite: () => (/* binding */ createInvite),\n/* harmony export */   listInvites: () => (/* binding */ listInvites),\n/* harmony export */   regenerateInvite: () => (/* binding */ regenerateInvite),\n/* harmony export */   revokeInvite: () => (/* binding */ revokeInvite)\n/* harmony export */ });\n/* harmony import */ var _prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./prisma */ \"(api)/./lib/prisma.ts\");\n/* harmony import */ var _tokenUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./tokenUtils */ \"(api)/./lib/tokenUtils.ts\");\n\n\nasync function listInvites(actorEmail, opts) {\n    const actor = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n        where: {\n            email: actorEmail.toLowerCase()\n        }\n    });\n    if (!actor) throw new Error(\"forbidden\");\n    const limit = Math.min(50, opts.limit || 20);\n    const where = {};\n    if (opts.status) where.status = opts.status;\n    if (opts.q) where.email = {\n        contains: opts.q,\n        mode: \"insensitive\"\n    };\n    const invites = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.invitation.findMany({\n        where,\n        orderBy: {\n            createdAt: \"desc\"\n        },\n        take: limit + 1,\n        ...opts.cursor ? {\n            cursor: {\n                id: opts.cursor\n            },\n            skip: 1\n        } : {}\n    });\n    let nextCursor = null;\n    if (invites.length > limit) {\n        const next = invites.pop();\n        nextCursor = next.id;\n    }\n    return {\n        invites,\n        nextCursor\n    };\n}\nasync function createInvite(actorEmail, params) {\n    const actor = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n        where: {\n            email: actorEmail.toLowerCase()\n        }\n    });\n    if (!actor) throw new Error(\"forbidden\");\n    const desiredRole = params.role || \"MEMBER\";\n    const allowedRoles = [\n        \"MEMBER\",\n        \"SCRUM_MASTER\",\n        \"ADMIN\"\n    ];\n    if (!allowedRoles.includes(desiredRole)) throw new Error(\"invalid role\");\n    if ((desiredRole === \"SCRUM_MASTER\" || desiredRole === \"ADMIN\") && actor.role !== \"ADMIN\") {\n        throw new Error(\"only ADMIN can invite SCRUM_MASTER or ADMIN\");\n    }\n    const token = (0,_tokenUtils__WEBPACK_IMPORTED_MODULE_1__.generateToken)();\n    const tokenHash = (0,_tokenUtils__WEBPACK_IMPORTED_MODULE_1__.hashToken)(token);\n    const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);\n    const invite = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.invitation.create({\n        data: {\n            email: params.email,\n            squadId: params.squadId,\n            tokenHash,\n            expiresAt,\n            invitedRole: desiredRole\n        }\n    });\n    try {\n        await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.auditLog.create({\n            data: {\n                actorId: actor.id,\n                action: \"CREATE_INVITE\",\n                meta: {\n                    inviteId: invite.id,\n                    email: params.email,\n                    squadId: params.squadId,\n                    role: desiredRole\n                }\n            }\n        });\n    } catch (e) {\n        console.warn(\"Failed to write audit log\", e);\n    }\n    return {\n        id: invite.id,\n        token\n    };\n}\nasync function regenerateInvite(actorEmail, inviteId) {\n    const actor = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n        where: {\n            email: actorEmail.toLowerCase()\n        }\n    });\n    if (!actor) throw new Error(\"forbidden\");\n    if (actor.role !== \"ADMIN\") throw new Error(\"only ADMIN can regenerate tokens\");\n    const newToken = (0,_tokenUtils__WEBPACK_IMPORTED_MODULE_1__.generateToken)();\n    const newTokenHash = (0,_tokenUtils__WEBPACK_IMPORTED_MODULE_1__.hashToken)(newToken);\n    const newExpires = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000);\n    const updated = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.invitation.update({\n        where: {\n            id: inviteId\n        },\n        data: {\n            tokenHash: newTokenHash,\n            expiresAt: newExpires\n        }\n    });\n    try {\n        await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.auditLog.create({\n            data: {\n                actorId: actor.id,\n                action: \"REGENERATE_INVITE\",\n                meta: {\n                    inviteId\n                }\n            }\n        });\n    } catch (e) {\n        console.warn(\"Failed to write audit log\", e);\n    }\n    return {\n        id: updated.id,\n        token: newToken\n    };\n}\nasync function revokeInvite(actorEmail, inviteId) {\n    const actor = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n        where: {\n            email: actorEmail.toLowerCase()\n        }\n    });\n    if (!actor) throw new Error(\"forbidden\");\n    if (actor.role !== \"ADMIN\") throw new Error(\"only ADMIN can revoke invites\");\n    const updated = await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.invitation.update({\n        where: {\n            id: inviteId\n        },\n        data: {\n            status: \"EXPIRED\"\n        }\n    });\n    try {\n        await _prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.auditLog.create({\n            data: {\n                actorId: actor.id,\n                action: \"REVOKE_INVITE\",\n                meta: {\n                    inviteId\n                }\n            }\n        });\n    } catch (e) {\n        console.warn(\"Failed to write audit log\", e);\n    }\n    // notify via brevo if configured\n    try {\n        const brevoKey = process.env.BREVO_API_KEY;\n        if (brevoKey) {\n            await fetch(\"https://api.brevo.com/v3/smtp/email\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"api-key\": brevoKey\n                },\n                body: JSON.stringify({\n                    sender: {\n                        name: \"SprintCap\",\n                        email: \"no-reply@example.com\"\n                    },\n                    to: [\n                        {\n                            email: updated.email\n                        }\n                    ],\n                    subject: \"Your invite has been revoked\",\n                    htmlContent: `<p>Your invitation to SprintCap has been revoked by an administrator.</p>`\n                })\n            });\n        }\n    } catch (e) {\n        console.warn(\"Failed to send revoke email\", e);\n    }\n    return {\n        id: updated.id\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvaW52aXRlU2VydmljZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBaUM7QUFDc0I7QUFFaEQsZUFBZUcsWUFBWUMsVUFBa0IsRUFBRUMsSUFBcUc7SUFDekosTUFBTUMsUUFBUSxNQUFNTiwyQ0FBTUEsQ0FBQ08sSUFBSSxDQUFDQyxVQUFVLENBQUM7UUFBRUMsT0FBTztZQUFFQyxPQUFPTixXQUFXTyxXQUFXO1FBQUc7SUFBRTtJQUN4RixJQUFJLENBQUNMLE9BQU8sTUFBTSxJQUFJTSxNQUFNO0lBRTVCLE1BQU1DLFFBQVFDLEtBQUtDLEdBQUcsQ0FBQyxJQUFJVixLQUFLUSxLQUFLLElBQUk7SUFDekMsTUFBTUosUUFBYSxDQUFDO0lBQ3BCLElBQUlKLEtBQUtXLE1BQU0sRUFBRVAsTUFBTU8sTUFBTSxHQUFHWCxLQUFLVyxNQUFNO0lBQzNDLElBQUlYLEtBQUtZLENBQUMsRUFBRVIsTUFBTUMsS0FBSyxHQUFHO1FBQUVRLFVBQVViLEtBQUtZLENBQUM7UUFBRUUsTUFBTTtJQUFjO0lBRWxFLE1BQU1DLFVBQVUsTUFBTXBCLDJDQUFNQSxDQUFDcUIsVUFBVSxDQUFDQyxRQUFRLENBQUM7UUFDL0NiO1FBQ0FjLFNBQVM7WUFBRUMsV0FBVztRQUFPO1FBQzdCQyxNQUFNWixRQUFRO1FBQ2QsR0FBSVIsS0FBS3FCLE1BQU0sR0FBRztZQUFFQSxRQUFRO2dCQUFFQyxJQUFJdEIsS0FBS3FCLE1BQU07WUFBQztZQUFHRSxNQUFNO1FBQUUsSUFBSSxDQUFDLENBQUM7SUFDakU7SUFFQSxJQUFJQyxhQUE0QjtJQUNoQyxJQUFJVCxRQUFRVSxNQUFNLEdBQUdqQixPQUFPO1FBQzFCLE1BQU1rQixPQUFPWCxRQUFRWSxHQUFHO1FBQ3hCSCxhQUFhRSxLQUFLSixFQUFFO0lBQ3RCO0lBQ0EsT0FBTztRQUFFUDtRQUFTUztJQUFXO0FBQy9CO0FBRU8sZUFBZUksYUFBYTdCLFVBQWtCLEVBQUU4QixNQUFpRTtJQUN0SCxNQUFNNUIsUUFBUSxNQUFNTiwyQ0FBTUEsQ0FBQ08sSUFBSSxDQUFDQyxVQUFVLENBQUM7UUFBRUMsT0FBTztZQUFFQyxPQUFPTixXQUFXTyxXQUFXO1FBQUc7SUFBRTtJQUN4RixJQUFJLENBQUNMLE9BQU8sTUFBTSxJQUFJTSxNQUFNO0lBRTVCLE1BQU11QixjQUFlRCxPQUFPRSxJQUFJLElBQUk7SUFDcEMsTUFBTUMsZUFBZTtRQUFDO1FBQVU7UUFBZ0I7S0FBUTtJQUN4RCxJQUFJLENBQUNBLGFBQWFDLFFBQVEsQ0FBQ0gsY0FBYyxNQUFNLElBQUl2QixNQUFNO0lBQ3pELElBQUksQ0FBQ3VCLGdCQUFnQixrQkFBa0JBLGdCQUFnQixPQUFNLEtBQU0sTUFBZUMsSUFBSSxLQUFLLFNBQVM7UUFDbEcsTUFBTSxJQUFJeEIsTUFBTTtJQUNsQjtJQUVBLE1BQU0yQixRQUFRckMsMERBQWFBO0lBQzNCLE1BQU1zQyxZQUFZdkMsc0RBQVNBLENBQUNzQztJQUM1QixNQUFNRSxZQUFZLElBQUlDLEtBQUtBLEtBQUtDLEdBQUcsS0FBSyxJQUFJLEtBQUssS0FBSyxLQUFLO0lBRTNELE1BQU1DLFNBQVMsTUFBTTVDLDJDQUFNQSxDQUFDcUIsVUFBVSxDQUFDd0IsTUFBTSxDQUFDO1FBQUVDLE1BQU07WUFBRXBDLE9BQU93QixPQUFPeEIsS0FBSztZQUFFcUMsU0FBU2IsT0FBT2EsT0FBTztZQUFFUDtZQUFXQztZQUFXTyxhQUFhYjtRQUFZO0lBQUU7SUFFdkosSUFBSTtRQUNGLE1BQU1uQywyQ0FBTUEsQ0FBQ2lELFFBQVEsQ0FBQ0osTUFBTSxDQUFDO1lBQUVDLE1BQU07Z0JBQUVJLFNBQVM1QyxNQUFNcUIsRUFBRTtnQkFBRXdCLFFBQVE7Z0JBQWlCQyxNQUFNO29CQUFFQyxVQUFVVCxPQUFPakIsRUFBRTtvQkFBRWpCLE9BQU93QixPQUFPeEIsS0FBSztvQkFBRXFDLFNBQVNiLE9BQU9hLE9BQU87b0JBQUVYLE1BQU1EO2dCQUFZO1lBQUU7UUFBRTtJQUN0TCxFQUFFLE9BQU9tQixHQUFHO1FBQ1ZDLFFBQVFDLElBQUksQ0FBQyw2QkFBNkJGO0lBQzVDO0lBRUEsT0FBTztRQUFFM0IsSUFBSWlCLE9BQU9qQixFQUFFO1FBQUVZO0lBQU07QUFDaEM7QUFFTyxlQUFla0IsaUJBQWlCckQsVUFBa0IsRUFBRWlELFFBQWdCO0lBQ3pFLE1BQU0vQyxRQUFRLE1BQU1OLDJDQUFNQSxDQUFDTyxJQUFJLENBQUNDLFVBQVUsQ0FBQztRQUFFQyxPQUFPO1lBQUVDLE9BQU9OLFdBQVdPLFdBQVc7UUFBRztJQUFFO0lBQ3hGLElBQUksQ0FBQ0wsT0FBTyxNQUFNLElBQUlNLE1BQU07SUFDNUIsSUFBSSxNQUFld0IsSUFBSSxLQUFLLFNBQVMsTUFBTSxJQUFJeEIsTUFBTTtJQUVyRCxNQUFNOEMsV0FBV3hELDBEQUFhQTtJQUM5QixNQUFNeUQsZUFBZTFELHNEQUFTQSxDQUFDeUQ7SUFDL0IsTUFBTUUsYUFBYSxJQUFJbEIsS0FBS0EsS0FBS0MsR0FBRyxLQUFLLElBQUksS0FBSyxLQUFLLEtBQUs7SUFDNUQsTUFBTWtCLFVBQVUsTUFBTTdELDJDQUFNQSxDQUFDcUIsVUFBVSxDQUFDeUMsTUFBTSxDQUFDO1FBQUVyRCxPQUFPO1lBQUVrQixJQUFJMEI7UUFBUztRQUFHUCxNQUFNO1lBQUVOLFdBQVdtQjtZQUFjbEIsV0FBV21CO1FBQVc7SUFBRTtJQUNuSSxJQUFJO1FBQ0YsTUFBTTVELDJDQUFNQSxDQUFDaUQsUUFBUSxDQUFDSixNQUFNLENBQUM7WUFBRUMsTUFBTTtnQkFBRUksU0FBUzVDLE1BQU1xQixFQUFFO2dCQUFFd0IsUUFBUTtnQkFBcUJDLE1BQU07b0JBQUVDO2dCQUFTO1lBQUU7UUFBRTtJQUM5RyxFQUFFLE9BQU9DLEdBQUc7UUFDVkMsUUFBUUMsSUFBSSxDQUFDLDZCQUE2QkY7SUFDNUM7SUFDQSxPQUFPO1FBQUUzQixJQUFJa0MsUUFBUWxDLEVBQUU7UUFBRVksT0FBT21CO0lBQVM7QUFDM0M7QUFFTyxlQUFlSyxhQUFhM0QsVUFBa0IsRUFBRWlELFFBQWdCO0lBQ3JFLE1BQU0vQyxRQUFRLE1BQU1OLDJDQUFNQSxDQUFDTyxJQUFJLENBQUNDLFVBQVUsQ0FBQztRQUFFQyxPQUFPO1lBQUVDLE9BQU9OLFdBQVdPLFdBQVc7UUFBRztJQUFFO0lBQ3hGLElBQUksQ0FBQ0wsT0FBTyxNQUFNLElBQUlNLE1BQU07SUFDNUIsSUFBSSxNQUFld0IsSUFBSSxLQUFLLFNBQVMsTUFBTSxJQUFJeEIsTUFBTTtJQUNyRCxNQUFNaUQsVUFBVSxNQUFNN0QsMkNBQU1BLENBQUNxQixVQUFVLENBQUN5QyxNQUFNLENBQUM7UUFBRXJELE9BQU87WUFBRWtCLElBQUkwQjtRQUFTO1FBQUdQLE1BQU07WUFBRTlCLFFBQVE7UUFBVTtJQUFFO0lBQ3RHLElBQUk7UUFDRixNQUFNaEIsMkNBQU1BLENBQUNpRCxRQUFRLENBQUNKLE1BQU0sQ0FBQztZQUFFQyxNQUFNO2dCQUFFSSxTQUFTNUMsTUFBTXFCLEVBQUU7Z0JBQUV3QixRQUFRO2dCQUFpQkMsTUFBTTtvQkFBRUM7Z0JBQVM7WUFBRTtRQUFFO0lBQzFHLEVBQUUsT0FBT0MsR0FBRztRQUNWQyxRQUFRQyxJQUFJLENBQUMsNkJBQTZCRjtJQUM1QztJQUVBLGlDQUFpQztJQUNqQyxJQUFJO1FBQ0YsTUFBTVUsV0FBV0MsUUFBUUMsR0FBRyxDQUFDQyxhQUFhO1FBQzFDLElBQUlILFVBQVU7WUFDWixNQUFNSSxNQUFNLHVDQUF1QztnQkFDakRDLFFBQVE7Z0JBQ1JDLFNBQVM7b0JBQUUsZ0JBQWdCO29CQUFvQixXQUFXTjtnQkFBUztnQkFDbkVPLE1BQU1DLEtBQUtDLFNBQVMsQ0FBQztvQkFBRUMsUUFBUTt3QkFBRUMsTUFBTTt3QkFBYWpFLE9BQU87b0JBQXVCO29CQUFHa0UsSUFBSTt3QkFBQzs0QkFBRWxFLE9BQU9tRCxRQUFRbkQsS0FBSzt3QkFBQztxQkFBRTtvQkFBRW1FLFNBQVM7b0JBQWdDQyxhQUFhLENBQUMseUVBQXlFLENBQUM7Z0JBQUM7WUFDelA7UUFDRjtJQUNGLEVBQUUsT0FBT3hCLEdBQUc7UUFDVkMsUUFBUUMsSUFBSSxDQUFDLCtCQUErQkY7SUFDOUM7SUFFQSxPQUFPO1FBQUUzQixJQUFJa0MsUUFBUWxDLEVBQUU7SUFBQztBQUMxQiIsInNvdXJjZXMiOlsid2VicGFjazovL3NwcmludC1jYXBhY2l0eS1hcHAvLi9saWIvaW52aXRlU2VydmljZS50cz9jNmZjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4vcHJpc21hJ1xuaW1wb3J0IHsgaGFzaFRva2VuLCBnZW5lcmF0ZVRva2VuIH0gZnJvbSAnLi90b2tlblV0aWxzJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbGlzdEludml0ZXMoYWN0b3JFbWFpbDogc3RyaW5nLCBvcHRzOiB7IGxpbWl0PzogbnVtYmVyLCBjdXJzb3I/OiBzdHJpbmcgfCBudWxsLCBzdGF0dXM/OiBzdHJpbmcgfCB1bmRlZmluZWQsIHE/OiBzdHJpbmcgfCB1bmRlZmluZWQgfSkge1xuICBjb25zdCBhY3RvciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBlbWFpbDogYWN0b3JFbWFpbC50b0xvd2VyQ2FzZSgpIH0gfSlcbiAgaWYgKCFhY3RvcikgdGhyb3cgbmV3IEVycm9yKCdmb3JiaWRkZW4nKVxuXG4gIGNvbnN0IGxpbWl0ID0gTWF0aC5taW4oNTAsIG9wdHMubGltaXQgfHwgMjApXG4gIGNvbnN0IHdoZXJlOiBhbnkgPSB7fVxuICBpZiAob3B0cy5zdGF0dXMpIHdoZXJlLnN0YXR1cyA9IG9wdHMuc3RhdHVzXG4gIGlmIChvcHRzLnEpIHdoZXJlLmVtYWlsID0geyBjb250YWluczogb3B0cy5xLCBtb2RlOiAnaW5zZW5zaXRpdmUnIH1cblxuICBjb25zdCBpbnZpdGVzID0gYXdhaXQgcHJpc21hLmludml0YXRpb24uZmluZE1hbnkoe1xuICAgIHdoZXJlLFxuICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfSxcbiAgICB0YWtlOiBsaW1pdCArIDEsXG4gICAgLi4uKG9wdHMuY3Vyc29yID8geyBjdXJzb3I6IHsgaWQ6IG9wdHMuY3Vyc29yIH0sIHNraXA6IDEgfSA6IHt9KVxuICB9KVxuXG4gIGxldCBuZXh0Q3Vyc29yOiBzdHJpbmcgfCBudWxsID0gbnVsbFxuICBpZiAoaW52aXRlcy5sZW5ndGggPiBsaW1pdCkge1xuICAgIGNvbnN0IG5leHQgPSBpbnZpdGVzLnBvcCgpIVxuICAgIG5leHRDdXJzb3IgPSBuZXh0LmlkXG4gIH1cbiAgcmV0dXJuIHsgaW52aXRlcywgbmV4dEN1cnNvciB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVJbnZpdGUoYWN0b3JFbWFpbDogc3RyaW5nLCBwYXJhbXM6IHsgZW1haWw6IHN0cmluZywgc3F1YWRJZD86IHN0cmluZyB8IG51bGwsIHJvbGU/OiBzdHJpbmcgfSkge1xuICBjb25zdCBhY3RvciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBlbWFpbDogYWN0b3JFbWFpbC50b0xvd2VyQ2FzZSgpIH0gfSlcbiAgaWYgKCFhY3RvcikgdGhyb3cgbmV3IEVycm9yKCdmb3JiaWRkZW4nKVxuXG4gIGNvbnN0IGRlc2lyZWRSb2xlID0gKHBhcmFtcy5yb2xlIHx8ICdNRU1CRVInKVxuICBjb25zdCBhbGxvd2VkUm9sZXMgPSBbJ01FTUJFUicsICdTQ1JVTV9NQVNURVInLCAnQURNSU4nXVxuICBpZiAoIWFsbG93ZWRSb2xlcy5pbmNsdWRlcyhkZXNpcmVkUm9sZSkpIHRocm93IG5ldyBFcnJvcignaW52YWxpZCByb2xlJylcbiAgaWYgKChkZXNpcmVkUm9sZSA9PT0gJ1NDUlVNX01BU1RFUicgfHwgZGVzaXJlZFJvbGUgPT09ICdBRE1JTicpICYmIChhY3RvciBhcyBhbnkpLnJvbGUgIT09ICdBRE1JTicpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ29ubHkgQURNSU4gY2FuIGludml0ZSBTQ1JVTV9NQVNURVIgb3IgQURNSU4nKVxuICB9XG5cbiAgY29uc3QgdG9rZW4gPSBnZW5lcmF0ZVRva2VuKClcbiAgY29uc3QgdG9rZW5IYXNoID0gaGFzaFRva2VuKHRva2VuKVxuICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApXG5cbiAgY29uc3QgaW52aXRlID0gYXdhaXQgcHJpc21hLmludml0YXRpb24uY3JlYXRlKHsgZGF0YTogeyBlbWFpbDogcGFyYW1zLmVtYWlsLCBzcXVhZElkOiBwYXJhbXMuc3F1YWRJZCwgdG9rZW5IYXNoLCBleHBpcmVzQXQsIGludml0ZWRSb2xlOiBkZXNpcmVkUm9sZSB9IH0pXG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBwcmlzbWEuYXVkaXRMb2cuY3JlYXRlKHsgZGF0YTogeyBhY3RvcklkOiBhY3Rvci5pZCwgYWN0aW9uOiAnQ1JFQVRFX0lOVklURScsIG1ldGE6IHsgaW52aXRlSWQ6IGludml0ZS5pZCwgZW1haWw6IHBhcmFtcy5lbWFpbCwgc3F1YWRJZDogcGFyYW1zLnNxdWFkSWQsIHJvbGU6IGRlc2lyZWRSb2xlIH0gfSB9KVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gd3JpdGUgYXVkaXQgbG9nJywgZSlcbiAgfVxuXG4gIHJldHVybiB7IGlkOiBpbnZpdGUuaWQsIHRva2VuIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlZ2VuZXJhdGVJbnZpdGUoYWN0b3JFbWFpbDogc3RyaW5nLCBpbnZpdGVJZDogc3RyaW5nKSB7XG4gIGNvbnN0IGFjdG9yID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7IHdoZXJlOiB7IGVtYWlsOiBhY3RvckVtYWlsLnRvTG93ZXJDYXNlKCkgfSB9KVxuICBpZiAoIWFjdG9yKSB0aHJvdyBuZXcgRXJyb3IoJ2ZvcmJpZGRlbicpXG4gIGlmICgoYWN0b3IgYXMgYW55KS5yb2xlICE9PSAnQURNSU4nKSB0aHJvdyBuZXcgRXJyb3IoJ29ubHkgQURNSU4gY2FuIHJlZ2VuZXJhdGUgdG9rZW5zJylcblxuICBjb25zdCBuZXdUb2tlbiA9IGdlbmVyYXRlVG9rZW4oKVxuICBjb25zdCBuZXdUb2tlbkhhc2ggPSBoYXNoVG9rZW4obmV3VG9rZW4pXG4gIGNvbnN0IG5ld0V4cGlyZXMgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApXG4gIGNvbnN0IHVwZGF0ZWQgPSBhd2FpdCBwcmlzbWEuaW52aXRhdGlvbi51cGRhdGUoeyB3aGVyZTogeyBpZDogaW52aXRlSWQgfSwgZGF0YTogeyB0b2tlbkhhc2g6IG5ld1Rva2VuSGFzaCwgZXhwaXJlc0F0OiBuZXdFeHBpcmVzIH0gfSlcbiAgdHJ5IHtcbiAgICBhd2FpdCBwcmlzbWEuYXVkaXRMb2cuY3JlYXRlKHsgZGF0YTogeyBhY3RvcklkOiBhY3Rvci5pZCwgYWN0aW9uOiAnUkVHRU5FUkFURV9JTlZJVEUnLCBtZXRhOiB7IGludml0ZUlkIH0gfSB9KVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gd3JpdGUgYXVkaXQgbG9nJywgZSlcbiAgfVxuICByZXR1cm4geyBpZDogdXBkYXRlZC5pZCwgdG9rZW46IG5ld1Rva2VuIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJldm9rZUludml0ZShhY3RvckVtYWlsOiBzdHJpbmcsIGludml0ZUlkOiBzdHJpbmcpIHtcbiAgY29uc3QgYWN0b3IgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHsgd2hlcmU6IHsgZW1haWw6IGFjdG9yRW1haWwudG9Mb3dlckNhc2UoKSB9IH0pXG4gIGlmICghYWN0b3IpIHRocm93IG5ldyBFcnJvcignZm9yYmlkZGVuJylcbiAgaWYgKChhY3RvciBhcyBhbnkpLnJvbGUgIT09ICdBRE1JTicpIHRocm93IG5ldyBFcnJvcignb25seSBBRE1JTiBjYW4gcmV2b2tlIGludml0ZXMnKVxuICBjb25zdCB1cGRhdGVkID0gYXdhaXQgcHJpc21hLmludml0YXRpb24udXBkYXRlKHsgd2hlcmU6IHsgaWQ6IGludml0ZUlkIH0sIGRhdGE6IHsgc3RhdHVzOiAnRVhQSVJFRCcgfSB9KVxuICB0cnkge1xuICAgIGF3YWl0IHByaXNtYS5hdWRpdExvZy5jcmVhdGUoeyBkYXRhOiB7IGFjdG9ySWQ6IGFjdG9yLmlkLCBhY3Rpb246ICdSRVZPS0VfSU5WSVRFJywgbWV0YTogeyBpbnZpdGVJZCB9IH0gfSlcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIHdyaXRlIGF1ZGl0IGxvZycsIGUpXG4gIH1cblxuICAvLyBub3RpZnkgdmlhIGJyZXZvIGlmIGNvbmZpZ3VyZWRcbiAgdHJ5IHtcbiAgICBjb25zdCBicmV2b0tleSA9IHByb2Nlc3MuZW52LkJSRVZPX0FQSV9LRVlcbiAgICBpZiAoYnJldm9LZXkpIHtcbiAgICAgIGF3YWl0IGZldGNoKCdodHRwczovL2FwaS5icmV2by5jb20vdjMvc210cC9lbWFpbCcsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywgJ2FwaS1rZXknOiBicmV2b0tleSB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHNlbmRlcjogeyBuYW1lOiAnU3ByaW50Q2FwJywgZW1haWw6ICduby1yZXBseUBleGFtcGxlLmNvbScgfSwgdG86IFt7IGVtYWlsOiB1cGRhdGVkLmVtYWlsIH1dLCBzdWJqZWN0OiAnWW91ciBpbnZpdGUgaGFzIGJlZW4gcmV2b2tlZCcsIGh0bWxDb250ZW50OiBgPHA+WW91ciBpbnZpdGF0aW9uIHRvIFNwcmludENhcCBoYXMgYmVlbiByZXZva2VkIGJ5IGFuIGFkbWluaXN0cmF0b3IuPC9wPmAgfSlcbiAgICAgIH0pXG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gc2VuZCByZXZva2UgZW1haWwnLCBlKVxuICB9XG5cbiAgcmV0dXJuIHsgaWQ6IHVwZGF0ZWQuaWQgfVxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsImhhc2hUb2tlbiIsImdlbmVyYXRlVG9rZW4iLCJsaXN0SW52aXRlcyIsImFjdG9yRW1haWwiLCJvcHRzIiwiYWN0b3IiLCJ1c2VyIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiZW1haWwiLCJ0b0xvd2VyQ2FzZSIsIkVycm9yIiwibGltaXQiLCJNYXRoIiwibWluIiwic3RhdHVzIiwicSIsImNvbnRhaW5zIiwibW9kZSIsImludml0ZXMiLCJpbnZpdGF0aW9uIiwiZmluZE1hbnkiLCJvcmRlckJ5IiwiY3JlYXRlZEF0IiwidGFrZSIsImN1cnNvciIsImlkIiwic2tpcCIsIm5leHRDdXJzb3IiLCJsZW5ndGgiLCJuZXh0IiwicG9wIiwiY3JlYXRlSW52aXRlIiwicGFyYW1zIiwiZGVzaXJlZFJvbGUiLCJyb2xlIiwiYWxsb3dlZFJvbGVzIiwiaW5jbHVkZXMiLCJ0b2tlbiIsInRva2VuSGFzaCIsImV4cGlyZXNBdCIsIkRhdGUiLCJub3ciLCJpbnZpdGUiLCJjcmVhdGUiLCJkYXRhIiwic3F1YWRJZCIsImludml0ZWRSb2xlIiwiYXVkaXRMb2ciLCJhY3RvcklkIiwiYWN0aW9uIiwibWV0YSIsImludml0ZUlkIiwiZSIsImNvbnNvbGUiLCJ3YXJuIiwicmVnZW5lcmF0ZUludml0ZSIsIm5ld1Rva2VuIiwibmV3VG9rZW5IYXNoIiwibmV3RXhwaXJlcyIsInVwZGF0ZWQiLCJ1cGRhdGUiLCJyZXZva2VJbnZpdGUiLCJicmV2b0tleSIsInByb2Nlc3MiLCJlbnYiLCJCUkVWT19BUElfS0VZIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZW5kZXIiLCJuYW1lIiwidG8iLCJzdWJqZWN0IiwiaHRtbENvbnRlbnQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./lib/inviteService.ts\n");

/***/ }),

/***/ "(api)/./lib/prisma.ts":
/*!***********************!*\
  !*** ./lib/prisma.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst prisma = global.prisma || new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) global.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvcHJpc21hLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUE2QztBQU90QyxNQUFNQyxTQUFTQyxPQUFPRCxNQUFNLElBQUksSUFBSUQsd0RBQVlBLEdBQUU7QUFFekQsSUFBSUcsSUFBeUIsRUFBY0QsT0FBT0QsTUFBTSxHQUFHQSIsInNvdXJjZXMiOlsid2VicGFjazovL3NwcmludC1jYXBhY2l0eS1hcHAvLi9saWIvcHJpc21hLnRzPzk4MjIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnXG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXZhclxuICB2YXIgcHJpc21hOiBQcmlzbWFDbGllbnQgfCB1bmRlZmluZWRcbn1cblxuZXhwb3J0IGNvbnN0IHByaXNtYSA9IGdsb2JhbC5wcmlzbWEgfHwgbmV3IFByaXNtYUNsaWVudCgpXG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSBnbG9iYWwucHJpc21hID0gcHJpc21hXG4iXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwicHJpc21hIiwiZ2xvYmFsIiwicHJvY2VzcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/prisma.ts\n");

/***/ }),

/***/ "(api)/./lib/tokenUtils.ts":
/*!***************************!*\
  !*** ./lib/tokenUtils.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateToken: () => (/* binding */ generateToken),\n/* harmony export */   hashToken: () => (/* binding */ hashToken)\n/* harmony export */ });\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n\nfunction hashToken(token) {\n    return crypto__WEBPACK_IMPORTED_MODULE_0___default().createHash(\"sha256\").update(token).digest(\"hex\");\n}\nfunction generateToken(bytes = 24) {\n    return crypto__WEBPACK_IMPORTED_MODULE_0___default().randomBytes(bytes).toString(\"hex\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvdG9rZW5VdGlscy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQTJCO0FBRXBCLFNBQVNDLFVBQVVDLEtBQWE7SUFDckMsT0FBT0Ysd0RBQWlCLENBQUMsVUFBVUksTUFBTSxDQUFDRixPQUFPRyxNQUFNLENBQUM7QUFDMUQ7QUFFTyxTQUFTQyxjQUFjQyxRQUFRLEVBQUU7SUFDdEMsT0FBT1AseURBQWtCLENBQUNPLE9BQU9FLFFBQVEsQ0FBQztBQUM1QyIsInNvdXJjZXMiOlsid2VicGFjazovL3NwcmludC1jYXBhY2l0eS1hcHAvLi9saWIvdG9rZW5VdGlscy50cz9jNDVkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJ1xuXG5leHBvcnQgZnVuY3Rpb24gaGFzaFRva2VuKHRva2VuOiBzdHJpbmcpIHtcbiAgcmV0dXJuIGNyeXB0by5jcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUodG9rZW4pLmRpZ2VzdCgnaGV4Jylcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlVG9rZW4oYnl0ZXMgPSAyNCkge1xuICByZXR1cm4gY3J5cHRvLnJhbmRvbUJ5dGVzKGJ5dGVzKS50b1N0cmluZygnaGV4Jylcbn1cbiJdLCJuYW1lcyI6WyJjcnlwdG8iLCJoYXNoVG9rZW4iLCJ0b2tlbiIsImNyZWF0ZUhhc2giLCJ1cGRhdGUiLCJkaWdlc3QiLCJnZW5lcmF0ZVRva2VuIiwiYnl0ZXMiLCJyYW5kb21CeXRlcyIsInRvU3RyaW5nIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/tokenUtils.ts\n");

/***/ }),

/***/ "(api)/./pages/api/invite.ts":
/*!*****************************!*\
  !*** ./pages/api/invite.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"next-auth\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/auth */ \"(api)/./lib/auth.ts\");\n/* harmony import */ var _lib_inviteService__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../lib/inviteService */ \"(api)/./lib/inviteService.ts\");\n\n\n\nasync function handler(req, res) {\n    // Allow listing invites\n    if (req.method === \"GET\") {\n        // Dev/test helper: allow bypassing NextAuth when NODE_ENV !== 'production' by providing\n        // an `x-test-user` header or `?test_user=` query param. This helps E2E tests avoid stubbing auth.\n        let session = null;\n        if (true) {\n            const testUser = req.headers[\"x-test-user\"] || req.query.test_user;\n            if (testUser) {\n                session = {\n                    user: {\n                        email: testUser.toLowerCase(),\n                        name: testUser\n                    }\n                };\n            }\n        }\n        if (!session) session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_0__.getServerSession)(req, res, _lib_auth__WEBPACK_IMPORTED_MODULE_1__.authOptions);\n        if (!session || !session.user?.email) return res.status(401).json({\n            error: \"unauthenticated\"\n        });\n        try {\n            const data = await (0,_lib_inviteService__WEBPACK_IMPORTED_MODULE_2__.listInvites)(session.user.email, {\n                limit: parseInt(req.query.limit || \"20\"),\n                cursor: req.query.cursor,\n                status: req.query.status,\n                q: req.query.q || undefined\n            });\n            return res.status(200).json(data);\n        } catch (e) {\n            return res.status(403).json({\n                error: e.message\n            });\n        }\n    }\n    if (req.method !== \"POST\") return res.status(405).end();\n    const body = req.body || {};\n    try {\n        // Dev/test helper: allow bypassing NextAuth when NODE_ENV !== 'production' by providing\n        // an `x-test-user` header or `?test_user=` query param. This helps E2E tests avoid stubbing auth.\n        let session = null;\n        if (true) {\n            const testUser = req.headers[\"x-test-user\"] || req.query.test_user;\n            if (testUser) {\n                session = {\n                    user: {\n                        email: testUser.toLowerCase(),\n                        name: testUser\n                    }\n                };\n            }\n        }\n        if (!session) session = await (0,next_auth__WEBPACK_IMPORTED_MODULE_0__.getServerSession)(req, res, _lib_auth__WEBPACK_IMPORTED_MODULE_1__.authOptions);\n        if (!session || !session.user?.email) return res.status(401).json({\n            error: \"unauthenticated\"\n        });\n        const actorEmail = session.user.email;\n        if (body.action === \"regenerate\") {\n            const { inviteId } = body;\n            if (!inviteId) return res.status(400).json({\n                error: \"inviteId required\"\n            });\n            try {\n                const data = await (0,_lib_inviteService__WEBPACK_IMPORTED_MODULE_2__.regenerateInvite)(actorEmail, inviteId);\n                return res.status(200).json(data);\n            } catch (e) {\n                return res.status(403).json({\n                    error: e.message\n                });\n            }\n        }\n        if (body.action === \"revoke\") {\n            const { inviteId } = body;\n            if (!inviteId) return res.status(400).json({\n                error: \"inviteId required\"\n            });\n            try {\n                const data = await (0,_lib_inviteService__WEBPACK_IMPORTED_MODULE_2__.revokeInvite)(actorEmail, inviteId);\n                return res.status(200).json(data);\n            } catch (e) {\n                return res.status(403).json({\n                    error: e.message\n                });\n            }\n        }\n        // create\n        const { email, squadId, role } = body;\n        if (!email) return res.status(400).json({\n            error: \"email required\"\n        });\n        try {\n            const data = await (0,_lib_inviteService__WEBPACK_IMPORTED_MODULE_2__.createInvite)(session.user.email, {\n                email,\n                squadId,\n                role\n            });\n            return res.status(201).json(data);\n        } catch (e) {\n            return res.status(400).json({\n                error: e.message\n            });\n        }\n    } catch (e) {\n        return res.status(500).json({\n            error: e.message\n        });\n    }\n} // Note: the route above handles GET and POST. To support revoke via POST action: 'revoke'\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFPTyxFQUFFQyxPQUFPO1FBQUM7SUFDakQ7QUFDRixFQUVBLDBGQUEwRiIsInNvdXJjZXMiOlsid2VicGFjazovL3NwcmludC1jYXBhY2l0eS1hcHAvLi9wYWdlcy9hcGkvaW52aXRlLnRzPzc3MTEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCdcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJy4uLy4uL2xpYi9wcmlzbWEnXG5pbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoJ1xuaW1wb3J0IHsgYXV0aE9wdGlvbnMgfSBmcm9tICcuLi8uLi9saWIvYXV0aCdcbmltcG9ydCB7IGxpc3RJbnZpdGVzLCBjcmVhdGVJbnZpdGUsIHJlZ2VuZXJhdGVJbnZpdGUsIHJldm9rZUludml0ZSB9IGZyb20gJy4uLy4uL2xpYi9pbnZpdGVTZXJ2aWNlJ1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XG4gIC8vIEFsbG93IGxpc3RpbmcgaW52aXRlc1xuICBpZiAocmVxLm1ldGhvZCA9PT0gJ0dFVCcpIHtcbiAgICAvLyBEZXYvdGVzdCBoZWxwZXI6IGFsbG93IGJ5cGFzc2luZyBOZXh0QXV0aCB3aGVuIE5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgYnkgcHJvdmlkaW5nXG4gICAgLy8gYW4gYHgtdGVzdC11c2VyYCBoZWFkZXIgb3IgYD90ZXN0X3VzZXI9YCBxdWVyeSBwYXJhbS4gVGhpcyBoZWxwcyBFMkUgdGVzdHMgYXZvaWQgc3R1YmJpbmcgYXV0aC5cbiAgbGV0IHNlc3Npb246IGFueSA9IG51bGxcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgY29uc3QgdGVzdFVzZXIgPSAocmVxLmhlYWRlcnNbJ3gtdGVzdC11c2VyJ10gYXMgc3RyaW5nKSB8fCAocmVxLnF1ZXJ5LnRlc3RfdXNlciBhcyBzdHJpbmcgfCB1bmRlZmluZWQpXG4gICAgICBpZiAodGVzdFVzZXIpIHtcbiAgICAgICAgc2Vzc2lvbiA9IHsgdXNlcjogeyBlbWFpbDogdGVzdFVzZXIudG9Mb3dlckNhc2UoKSwgbmFtZTogdGVzdFVzZXIgfSB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghc2Vzc2lvbikgc2Vzc2lvbiA9IGF3YWl0IGdldFNlcnZlclNlc3Npb24ocmVxLCByZXMsIGF1dGhPcHRpb25zIGFzIGFueSlcbiAgICBpZiAoIXNlc3Npb24gfHwgIShzZXNzaW9uIGFzIGFueSkudXNlcj8uZW1haWwpIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiAndW5hdXRoZW50aWNhdGVkJyB9KVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgbGlzdEludml0ZXMoKHNlc3Npb24gYXMgYW55KS51c2VyLmVtYWlsLCB7IGxpbWl0OiBwYXJzZUludCgocmVxLnF1ZXJ5LmxpbWl0IGFzIHN0cmluZykgfHwgJzIwJyksIGN1cnNvcjogcmVxLnF1ZXJ5LmN1cnNvciBhcyBzdHJpbmcgfCB1bmRlZmluZWQsIHN0YXR1czogcmVxLnF1ZXJ5LnN0YXR1cyBhcyBzdHJpbmcgfCB1bmRlZmluZWQsIHE6IChyZXEucXVlcnkucSBhcyBzdHJpbmcgfCB1bmRlZmluZWQpIHx8IHVuZGVmaW5lZCB9KVxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKGRhdGEpXG4gICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBlcnJvcjogZS5tZXNzYWdlIH0pXG4gICAgfVxuICB9XG5cbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykgcmV0dXJuIHJlcy5zdGF0dXMoNDA1KS5lbmQoKVxuXG4gIGNvbnN0IGJvZHkgPSByZXEuYm9keSB8fCB7fVxuICAgIHRyeSB7XG4gICAgLy8gRGV2L3Rlc3QgaGVscGVyOiBhbGxvdyBieXBhc3NpbmcgTmV4dEF1dGggd2hlbiBOT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nIGJ5IHByb3ZpZGluZ1xuICAgIC8vIGFuIGB4LXRlc3QtdXNlcmAgaGVhZGVyIG9yIGA/dGVzdF91c2VyPWAgcXVlcnkgcGFyYW0uIFRoaXMgaGVscHMgRTJFIHRlc3RzIGF2b2lkIHN0dWJiaW5nIGF1dGguXG4gIGxldCBzZXNzaW9uOiBhbnkgPSBudWxsXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcbiAgICAgIGNvbnN0IHRlc3RVc2VyID0gKHJlcS5oZWFkZXJzWyd4LXRlc3QtdXNlciddIGFzIHN0cmluZykgfHwgKHJlcS5xdWVyeS50ZXN0X3VzZXIgYXMgc3RyaW5nIHwgdW5kZWZpbmVkKVxuICAgICAgaWYgKHRlc3RVc2VyKSB7XG4gICAgICAgIHNlc3Npb24gPSB7IHVzZXI6IHsgZW1haWw6IHRlc3RVc2VyLnRvTG93ZXJDYXNlKCksIG5hbWU6IHRlc3RVc2VyIH0gfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIXNlc3Npb24pIHNlc3Npb24gPSBhd2FpdCBnZXRTZXJ2ZXJTZXNzaW9uKHJlcSwgcmVzLCBhdXRoT3B0aW9ucyBhcyBhbnkpXG4gICAgaWYgKCFzZXNzaW9uIHx8ICEoc2Vzc2lvbiBhcyBhbnkpLnVzZXI/LmVtYWlsKSByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBlcnJvcjogJ3VuYXV0aGVudGljYXRlZCcgfSlcbiAgICBjb25zdCBhY3RvckVtYWlsID0gKHNlc3Npb24gYXMgYW55KS51c2VyLmVtYWlsXG5cbiAgICBpZiAoYm9keS5hY3Rpb24gPT09ICdyZWdlbmVyYXRlJykge1xuICAgICAgY29uc3QgeyBpbnZpdGVJZCB9ID0gYm9keVxuICAgICAgaWYgKCFpbnZpdGVJZCkgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdpbnZpdGVJZCByZXF1aXJlZCcgfSlcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZWdlbmVyYXRlSW52aXRlKGFjdG9yRW1haWwsIGludml0ZUlkKVxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oZGF0YSlcbiAgICAgIH0gY2F0Y2ggKGU6YW55KSB7IHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiBlLm1lc3NhZ2UgfSkgfVxuICAgIH1cblxuICAgIGlmIChib2R5LmFjdGlvbiA9PT0gJ3Jldm9rZScpIHtcbiAgICAgIGNvbnN0IHsgaW52aXRlSWQgfSA9IGJvZHlcbiAgICAgIGlmICghaW52aXRlSWQpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnaW52aXRlSWQgcmVxdWlyZWQnIH0pXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmV2b2tlSW52aXRlKGFjdG9yRW1haWwsIGludml0ZUlkKVxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oZGF0YSlcbiAgICAgIH0gY2F0Y2ggKGU6YW55KSB7IHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IGVycm9yOiBlLm1lc3NhZ2UgfSkgfVxuICAgIH1cblxuICAgIC8vIGNyZWF0ZVxuICAgIGNvbnN0IHsgZW1haWwsIHNxdWFkSWQsIHJvbGUgfSA9IGJvZHlcbiAgICBpZiAoIWVtYWlsKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ2VtYWlsIHJlcXVpcmVkJyB9KVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgY3JlYXRlSW52aXRlKChzZXNzaW9uIGFzIGFueSkudXNlci5lbWFpbCwgeyBlbWFpbCwgc3F1YWRJZCwgcm9sZSB9KVxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAxKS5qc29uKGRhdGEpXG4gICAgfSBjYXRjaCAoZTphbnkpIHtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBlLm1lc3NhZ2UgfSlcbiAgICB9XG4gIH0gY2F0Y2ggKGU6YW55KSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGUubWVzc2FnZSB9KVxuICB9XG59XG5cbi8vIE5vdGU6IHRoZSByb3V0ZSBhYm92ZSBoYW5kbGVzIEdFVCBhbmQgUE9TVC4gVG8gc3VwcG9ydCByZXZva2UgdmlhIFBPU1QgYWN0aW9uOiAncmV2b2tlJ1xuIl0sIm5hbWVzIjpbImdldFNlcnZlclNlc3Npb24iLCJhdXRoT3B0aW9ucyIsImxpc3RJbnZpdGVzIiwiY3JlYXRlSW52aXRlIiwicmVnZW5lcmF0ZUludml0ZSIsInJldm9rZUludml0ZSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJzZXNzaW9uIiwicHJvY2VzcyIsInRlc3RVc2VyIiwiaGVhZGVycyIsInF1ZXJ5IiwidGVzdF91c2VyIiwidXNlciIsImVtYWlsIiwidG9Mb3dlckNhc2UiLCJuYW1lIiwic3RhdHVzIiwianNvbiIsImVycm9yIiwiZGF0YSIsImxpbWl0IiwicGFyc2VJbnQiLCJjdXJzb3IiLCJxIiwidW5kZWZpbmVkIiwiZSIsIm1lc3NhZ2UiLCJlbmQiLCJib2R5IiwiYWN0b3JFbWFpbCIsImFjdGlvbiIsImludml0ZUlkIiwic3F1YWRJZCIsInJvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/invite.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Finvite&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Finvite.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();