# GitHub Copilot Instructions: Capacity Plan Tab

**Feature**: 021-as-scrum-master
**Date**: 2025-10-10

## Feature Overview
Implement a "Capacity Plan" tab for Scrum Masters to view and manage active sprints (capacity plans) with full CRUD operations on associated Jira tickets.

## Key Requirements
- Display active sprints in individual cards
- Active sprints are those explicitly marked as active by Scrum Masters
- Each card contains CRUD operations for Jira tickets
- Restrict access to Scrum Masters only
- Use shadcn/ui components exclusively

## Technical Stack
- TypeScript 5.x + Next.js App Router
- Tailwind CSS + shadcn/ui
- Prisma + PostgreSQL (Neon)
- NextAuth for authentication
- Jira REST API for ticket operations

## Implementation Guidelines

### Database Schema
- Extend Sprint model with `isActive: boolean`
- Add new Ticket model with relationship to Sprint
- Include fields: title, description, status, assignee, jiraKey

### API Endpoints
- GET /api/capacity-plan/active-sprints
- POST /api/capacity-plan/[sprintId]/activate
- CRUD endpoints for tickets under /api/capacity-plan/[sprintId]/tickets

### UI Components
- Use shadcn/ui Card, Button, Dialog, Form components
- Responsive grid layout for capacity plan cards
- Consistent with existing app design patterns

### Authentication & Authorization
- Verify user is Scrum Master of relevant squads
- Use existing NextAuth session validation
- Add squad membership checks in API routes

### Error Handling
- Graceful handling of Jira API failures
- User-friendly error messages
- Proper HTTP status codes

### Testing
- Unit tests for services and utilities
- E2E tests for complete user flows
- Include data-testid attributes for test selectors

## Code Quality Standards
- TypeScript strict mode enabled
- ESLint and Prettier configured
- Follow existing code patterns in the codebase
- Add JSDoc comments for public APIs
- Use meaningful variable and function names

## Security Considerations
- Validate all user inputs
- Use parameterized database queries
- Store Jira credentials securely in environment variables
- Implement rate limiting on API endpoints

## Performance Goals
- Page load <200ms
- Mobile response <150ms
- Efficient database queries with proper indexing
- Minimize Jira API calls through caching where appropriate

## File Structure
Follow the planned structure in plan.md:
- app/dashboard/capacity-plan/ for the main page
- app/api/capacity-plan/ for API routes
- components/ for reusable UI components
- lib/services/ for business logic

## Testing on Production
Remember to test all changes on www.sprintcap.info, not Vercel preview URLs, due to Google OAuth restrictions.